![](https://raw.githubusercontent.com/EcoCommons-Australia-2024-2026/ec-notebook_site/main/images/notebooks_banner_withframe.png)

# How to determine extent of occurrence (EOO) and area of occupancy (AOO) for a species

Author details: Dr Jenna Wraith and Dr Sebastian Lopez Marcano

Editor details: Xiang Zhao

Contact details: support\@ecocommons.org.au

Copyright statement: This script is the product of the EcoCommons platform. Please refer to the EcoCommons website for more details: <https://www.ecocommons.org.au/>

Date: March 2025

# Script and data info:

This notebook, developed by the EcoCommons team, showcases how to determine the extent of occurrence (EOO) and area of occupancy (AOO) for a species. 

# Introduction
## Extent of occurrence (EOO)
Extent of Occurrence (EOO): The EOO represents the total geographic spread of a species. It’s defined as the area within the smallest convex polygon that encompasses all known occurrences of the species. Ecologically, EOO is a critical metric for assessing the distributional range of a species and is used in conservation to estimate risk. Species with a small EOO are more likely to be susceptible to extinction because their populations are more likely to be impacted by habitat changes, climate fluctuations, and human activities across their limited range.

## Area of Occupancy (AOO)
The AOO is a more fine-scale measurement of where a species is actually found within its range. This metric accounts for the specific locations where the species occupies habitat within the broader EOO and is calculated using a grid-based approach, typically with cells sized to 2x2 km as per IUCN standards. AOO provides insight into habitat specificity, population density, and the effects of habitat fragmentation. Lower AOO values imply that the species is confined to smaller, often isolated patches, which could increase its vulnerability.

## A short explanation of the notebook
This notebook calculates two important ecological metrics, the Extent of Occurrence (EOO) and the Area of Occupancy (AOO), for the species Cycas megacarpa. These metrics are commonly used to assess species conservation status by providing information on the geographic range and area occupied by the species.

# Set-up: R Environment and Packages
For this notebook we are going to use ConR, which includes a EOO.computing and AOO.computing functions to calculate the EOO and AOO for a species. Similarly to other EcoCommons notebooks, we will use the `googledrive` package to download the sample dataset for this notebook. 

#Calculate Extent of Occurrence (EOO): EOO is calculated using the EOO.computing function from the ConR package. This metric represents the area within the smallest convex polygon that can encompass all known occurrence points of the species. If the EOO.computing function returns a null polygon, the script generates a convex hull as an alternative.
#Calculate Area of Occupancy (AOO): AOO is computed with the AOO.computing function, which uses a grid approach to calculate the area actually occupied by the species. In this script, a 2x2 km cell grid is used to estimate the AOO.
#Visualise Results: A map is generated with ggplot2, showing the land area, species occurrence points, and the EOO polygon (convex hull). The EOO and AOO values are displayed in an annotation box on the map.
#Save Map Output: Finally, the map is saved as a PNG file, allowing users to share or document the results.

```{r install_libraries}

# Set the workspace to the current working directory
#setwd("") # Uncomment and replace the path below with your own working directory if needed:

workspace <- getwd()  # Get the current working directory and store it in 'workspace'

# Increase the plot size by adjusting the options for plot dimensions in the notebook output
options(repr.plot.width = 16, repr.plot.height = 8)  # Sets width to 16 and height to 8 for larger plots

# Set CRAN mirror
options(repos = c(CRAN = "https://cran.rstudio.com/"))

# List of packages to check, install if needed, and load
packages <- c("googledrive", "lwgeom", "ggplot2" , "ggspatial", "sf", "devtools")

# Function to display a cat message
cat_message <- function(pkg, message_type) {
  if (message_type == "installed") {
    cat(paste0(pkg, " has been installed successfully!\n"))
  } else if (message_type == "loading") {
    cat(paste0(pkg, " is already installed and has been loaded!\n"))
  }
}

# Install missing packages and load them
for (pkg in packages) {
  if (!requireNamespace(pkg, quietly = TRUE)) {
    install.packages(pkg)
    cat_message(pkg, "installed")
  } else {
    cat_message(pkg, "loading")
  }
  library(pkg, character.only = TRUE)
}

# Install ConR from GitHub if not already installed
if (!requireNamespace("ConR", quietly = TRUE)) {
  devtools::install_github("gdauby/ConR")
  cat_message("ConR", "installed")
} else {
  cat_message("ConR", "loading")
}

# Load the ConR package
library(ConR)

# De-authenticate Google Drive to access public files
drive_deauth()
```

# Access the data 
## Species of interest: Cycas megacarpa
Cycas megacarpa is a species of cycad native to Queensland, Australia that is listed as 'Endangered' on the EPBC Act Listing Status (2000). Calculating the EOO and AOO for species like Cycas megacarpa is essential for understanding their conservation status and identifying potential threats to remaining populations. Given its status, websites such as Atlas of Living Australia (ALA) limit the display of occurrence data to protect the species from over-collection and habitat disturbance. 

The occurrence data for Cycas megacarpa is sourced from the Atlas of Living Australia (ALA) and is provided as a CSV file. The dataset includes the latitude and longitude coordinates of species occurrences, which are used to calculate the EOO and AOO metrics.

```{r download_data}

# De-authenticate Google Drive to access public files
drive_deauth()

# Define Google Drive file ID and the path for downloading
zip_file_id <- "1gmXK4ewyE35wrjzGD2d5WbL-H8pApdPv" # Replace with the actual file ID of the zipped file
datafolder_path <- file.path(workspace)

# Create a local path for the zipped file
zip_file_path <- file.path(datafolder_path, "Cycas_megacarpa_eoo.zip")

# Function to download a file with progress messages
download_zip_file <- function(file_id, file_path) {
  cat("Downloading zipped file...\n")
  drive_download(as_id(file_id), path = file_path, overwrite = TRUE)
  cat("Downloaded zipped file to:", file_path, "\n")
}

# Create local directory if it doesn't exist
if (!dir.exists(datafolder_path)) {
  dir.create(datafolder_path, recursive = TRUE)
}

# Download the zipped file
cat("Starting to download the zipped file...\n")
download_zip_file(zip_file_id, zip_file_path)

# Unzip the downloaded file
cat("Unzipping the file...\n")
unzip(zip_file_path, exdir = datafolder_path)
cat("Unzipped files to folder:", datafolder_path, "\n")

```

# Data Preparation
## Load the data and convert it to an sf object
The occurrence data for Cycas megacarpa is loaded from the CSV file and converted to an sf object using the `st_as_sf` function from the `sf` package. The latitude and longitude columns are specified as the coordinates for the sf object. The coordinate reference system (CRS) is set to EPSG:4326 (WGS 84) to ensure the correct spatial representation of the data.

```{r load_data}

# Load the occurrence data for Cycas megacarpa
MyData <- read.csv('Cycas_megacarpa_eoo.csv')

species_points <- st_as_sf(MyData, coords = c("Longitude", "Latitude"), crs = 4326)

# Head of the species points data
head(species_points)
```

# Calculate Extent of Occurrence (EOO)
## Calculate the EOO using the EOO.computing function
The EOO for Cycas megacarpa is calculated using the `EOO.computing` function from the `ConR` package. The function takes the species occurrence points as input and returns the EOO polygon and EOO value. If the EOO polygon is NULL, a convex hull is generated from the species points as an alternative representation of the EOO.

```{r calculate_eoo}

# Calculate EOO (Extent of Occurrence)
EOO_polygon <- EOO.computing(MyData, export_shp = FALSE)

# Check if the spatial polygon is NULL
if (is.null(EOO_polygon$spatial.polygon_1)) {
  # Create the convex hull from the species points
  eoo_hull <- st_convex_hull(st_union(st_geometry(species_points)))
  # Save the convex hull as an sf object
  EOO_sf <- st_sf(geometry = eoo_hull)
} else {
  # Convert the existing polygon to an sf object if available
  EOO_sf <- st_as_sf(EOO_polygon$spatial.polygon_1)
}
```

# Calculate Area of Occupancy (AOO)
## Calculate the AOO using the AOO.computing function
The AOO for Cycas megacarpa is calculated using the `AOO.computing` function from the `ConR` package. The function takes the species occurrence points as input and returns the AOO value based on a 2x2 km grid. 
The AOO value represents the area actually occupied by the species within the grid cells.

```{r calculate_aoo}
# Calculate AOO (Area of Occupancy)
AOO_result <- AOO.computing(
  MyData,
  cell_size_AOO = 2,
  nbe.rep.rast.AOO = 0,
  parallel = FALSE,
  NbeCores = 2,
  show_progress = TRUE,
  export_shp = FALSE,
  proj_type = "cea"
)
```

# Visualise and analyse the results
## Visualise the EOO, AOO, and species occurrence points
Now, to conclude this short notebook, we will visualise the calculated EOO, AOO, and the species occurrence points on a map using `ggplot2`. The map will display the land area, species points, EOO polygon (or convex hull), and include annotations for the EOO and AOO values. The map will provide a visual representation of the species distribution and the extent of its occurrence.

```{r print aoo and eoo values}
# Extract the EOO and AOO values
print(paste("The EOO value is:", EOO_polygon$eoo, "km²"))
print(paste("The AOO value is:", AOO_result$aoo, "km²"))
```

```{r plot_map}
# Get the bounding box for the species points
bbox <- st_bbox(species_points)

# Create the ggplot with the layers
ggplot() +
  # Plot the land layer
  geom_sf(data = land, fill = "lightgreen", color = "darkgreen") +
  # Plot the EOO convex hull
  geom_sf(data = EOO_sf, fill = NA, color = "red", linetype = "dashed", size = 3) +
  # Plot the species points
  geom_sf(data = species_points, color = "blue", size = 2, shape = 16) +
  
  # Set coordinate limits based on the bounding box
  coord_sf(xlim = c(bbox["xmin"] - 0.5, bbox["xmax"] + 0.5), 
           ylim = c(bbox["ymin"] - 0.5, bbox["ymax"] + 0.5), expand = FALSE) +
  
  # Add EOO and AOO values as an annotation box
  annotate("label", 
           x = bbox["xmax"] - 0.2, 
           y = bbox["ymax"] - 0.2, 
           label = paste("EOO:", round(EOO_polygon$eoo, 2), "km²\nAOO:", round(AOO_result$aoo, 2), "km²"), 
           size = 5, 
           fill = "white", 
           color = "black", 
           fontface = "bold", 
           label.size = 0) +  # Removes the border around the label
  
  # Set gridlines at 2 km intervals
  scale_x_continuous(breaks = seq(floor(bbox["xmin"]), ceiling(bbox["xmax"]), by = 1)) +
  scale_y_continuous(breaks = seq(floor(bbox["ymin"]), ceiling(bbox["ymax"]), by = 1)) +
  
  # Customize the theme
  theme_minimal() +
  labs(title = "Extent of Occurrence (EOO) + Area of Occupancy (AOO) for Cycas megacarpa") +
  theme(legend.position = "none")  # Remove legend if not needed

```

# Conclusion
